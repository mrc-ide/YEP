<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="YEP">
<title>Worked Example 3 - Generating Epidemiological Data Sets • YEP</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Worked Example 3 - Generating Epidemiological Data Sets">
<meta property="og:description" content="YEP">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">YEP</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/A1Introduction.html">Introduction</a>
    <a class="dropdown-item" href="../articles/A2Installation.html">Installation</a>
    <a class="dropdown-item" href="../articles/BWorkedExampleAModelRun.html">Worked Example 1 - Single Model Run</a>
    <a class="dropdown-item" href="../articles/BWorkedExampleBOutbreakRiskCalculation.html">Worked Example 2 - Outbreak Risk Calculation</a>
    <a class="dropdown-item" href="../articles/BWorkedExampleCEpiDatasetGenerate.html">Worked Example 3 - Generating Epidemiological Data Sets</a>
    <a class="dropdown-item" href="../articles/BWorkedExampleDMCMC.html">Worked Example 4 - Parameter Estimation Using Markov Chain Monte Carlo Functions</a>
    <a class="dropdown-item" href="../articles/CGuideAInputs.html">Guide 1 - Inputs</a>
    <a class="dropdown-item" href="../articles/CGuideBParametersEnvironment.html">Guide 2 - Calculating Parameters From Environmental Data</a>
    <a class="dropdown-item" href="../articles/CGuideCModelResultsProcess.html">Guide 3 - Processing Model Results</a>
    <a class="dropdown-item" href="../articles/CGuideDEpiDataGenerate.html">Guide 4 - Generating Epidemiological Data From Model Output</a>
    <a class="dropdown-item" href="../articles/CGuideELikelihood.html">Guide 5 - Calculating Likelihood Of Observed Data</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Worked Example 3 - Generating Epidemiological Data Sets</h1>
            
      
      
      <div class="d-none name"><code>BWorkedExampleCEpiDatasetGenerate.Rmd</code></div>
    </div>

    
    
<p>This worked example demonstrates how to use the package to generate a
set of epidemiological data (serological and/or annual reported
severe/fatal cases) for specified years and regions (and age ranges, in
the case of serological data).</p>
<p>This can be set up to either:</p>
<ul>
<li>Match a set of observed data supplied in appropriate formats</li>
<li>Create a hypothetical set of data with no existing counterpart by
matching to “dummy” data which presents dates, regions and/or age ranges
in the appropriate formats</li>
</ul>
<p>We first load the input data set, regional environmental covariate
values, coefficients of environmental covariate values used to calculate
spillover FOI and R0 values, and observed serological and annual case
data (here generated by the model itself):</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mrc-ide.github.io/YEP/">YEP</a></span><span class="op">)</span></span>
<span><span class="va">input_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/find.package.html" class="external-link">path.package</a></span><span class="op">(</span><span class="st">"YEP"</span><span class="op">)</span>, </span>
<span>                                  <span class="st">"/exdata/input_data_example.Rds"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">enviro_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/find.package.html" class="external-link">path.package</a></span><span class="op">(</span><span class="st">"YEP"</span><span class="op">)</span>, </span>
<span>                                  <span class="st">"/exdata/enviro_data_example.csv"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,</span>
<span>                        header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">enviro_coeffs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/find.package.html" class="external-link">path.package</a></span><span class="op">(</span><span class="st">"YEP"</span><span class="op">)</span>, </span>
<span>                                       <span class="st">"/exdata/enviro_coeffs_example.csv"</span>,</span>
<span>                                       sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Seroprevalence data for comparison, by region, year &amp; age group, in format </span></span>
<span><span class="co"># no. samples/no. positives</span></span>
<span><span class="va">sero_template</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/find.package.html" class="external-link">path.package</a></span><span class="op">(</span><span class="st">"YEP"</span><span class="op">)</span>, </span>
<span>                                    <span class="st">"/exdata/sero_template_example.csv"</span>,</span>
<span>                                       sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>  </span>
<span><span class="co"># Annual reported case/death data for comparison, by region and year, in format </span></span>
<span><span class="co"># no. cases/no. deaths  </span></span>
<span><span class="va">case_template</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/find.package.html" class="external-link">path.package</a></span><span class="op">(</span><span class="st">"YEP"</span><span class="op">)</span>, </span>
<span>                                    <span class="st">"/exdata/case_template_example.csv"</span>,</span>
<span>                                       sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>   </span></code></pre></div>
<p>We calculate values of spillover FOI and R0 as described in <a href="https://mrc-ide.github.io/YEP/articles/CGuideBParametersEnvironment.html">Guide
2 - Calculating Parameters From Environmental Data</a>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_regions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">enviro_data</span><span class="op">)</span></span>
<span><span class="va">FOI_values</span><span class="op">=</span><span class="va">R0_values</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="va">n_regions</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">n_region</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_regions</span><span class="op">)</span><span class="op">{</span></span>
<span> <span class="va">FOI_R0_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/param_calc_enviro.html">param_calc_enviro</a></span><span class="op">(</span>enviro_coeffs <span class="op">=</span> <span class="va">enviro_coeffs</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span>, </span>
<span>                  enviro_covar_values <span class="op">=</span> <span class="va">enviro_data</span><span class="op">[</span><span class="va">n_region</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">enviro_data</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span> <span class="va">FOI_values</span><span class="op">[</span><span class="va">n_region</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">FOI_R0_values</span><span class="op">$</span><span class="va">FOI</span></span>
<span> <span class="va">R0_values</span><span class="op">[</span><span class="va">n_region</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">FOI_R0_values</span><span class="op">$</span><span class="va">R0</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We set the non-region-specific parameters for the dataset
generation:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vaccine_efficacy</span> <span class="op">&lt;-</span> <span class="fl">1.0</span> <span class="co"># Vaccine efficacy</span></span>
<span><span class="va">p_severe_inf</span> <span class="op">=</span> <span class="fl">0.12</span> <span class="co"># Probability of an infection causing severe symptoms</span></span>
<span><span class="va">p_death_severe_inf</span> <span class="op">=</span> <span class="fl">0.39</span> <span class="co"># Probability of an infection with severe symptoms causing death</span></span>
<span><span class="va">p_rep_severe</span> <span class="op">=</span> <span class="fl">0.1</span> <span class="co"># Probability of reporting of an infection with severe (non-fatal) symptoms</span></span>
<span><span class="va">p_rep_death</span> <span class="op">=</span> <span class="fl">0.2</span> <span class="co"># Probability of reporting of a fatal infection</span></span>
<span><span class="va">mode_start</span> <span class="op">&lt;-</span> <span class="fl">1</span>  <span class="co">#    </span></span>
<span><span class="va">start_SEIRV</span> <span class="op">&lt;-</span> <span class="cn">NULL</span> <span class="co">#        </span></span>
<span><span class="va">dt</span> <span class="op">&lt;-</span> <span class="fl">1.0</span> <span class="co"># Time increment in days</span></span>
<span><span class="va">n_reps</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="co"># Number of stochastic repetitions</span></span>
<span><span class="co"># True/false flag indicating whether or not to run model in deterministic mode</span></span>
<span><span class="co"># (so that binomial calculations give average instead of randomized output)</span></span>
<span><span class="va">deterministic</span> <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="co"># Variable to set different modes for running on multiple processors simultaneously;</span></span>
<span><span class="co"># here set to "none" so that parallel processing is not used</span></span>
<span><span class="va">mode_parallel</span><span class="op">=</span><span class="st">"none"</span></span></code></pre></div>
<p>We run the Generate_Dataset() function to produce the dataset. This
uses the approaches described in <a href="https://mrc-ide.github.io/YEP/articles/CGuideDEpiDataGenerate.html">Guide
4 - Generating Epidemiological Data From Model Output</a> to generate
serological and/or case data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">dataset1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Generate_Dataset.html">Generate_Dataset</a></span><span class="op">(</span><span class="va">input_data</span>,<span class="va">FOI_values</span>,<span class="va">R0_values</span>,<span class="va">sero_template</span>,<span class="va">case_template</span>,<span class="va">vaccine_efficacy</span>,</span>
<span>                             <span class="va">p_severe_inf</span>,<span class="va">p_death_severe_inf</span>,<span class="va">p_rep_severe</span>,<span class="va">p_rep_death</span>,<span class="va">mode_start</span>,</span>
<span>                             <span class="va">start_SEIRV</span>,<span class="va">dt</span>,<span class="va">n_reps</span>,<span class="va">deterministic</span>,<span class="va">mode_parallel</span>,cluster<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p>[TBA]</p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Keith Fraser.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
