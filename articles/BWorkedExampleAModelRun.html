<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Worked Example 1 - Single Model Run • YEP</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Worked Example 1 - Single Model Run">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">YEP</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/A1Introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/A2Installation.html">Installation</a></li>
    <li><a class="dropdown-item" href="../articles/BWorkedExampleAModelRun.html">Worked Example 1 - Single Model Run</a></li>
    <li><a class="dropdown-item" href="../articles/BWorkedExampleBOutbreakRiskCalculation.html">Worked Example 2 - Outbreak Risk Calculation</a></li>
    <li><a class="dropdown-item" href="../articles/BWorkedExampleCEpiDatasetGenerate.html">Worked Example 3 - Generating Epidemiological Data Sets</a></li>
    <li><a class="dropdown-item" href="../articles/BWorkedExampleDMCMC.html">Worked Example 4 - Parameter Estimation Using Markov Chain Monte Carlo Functions</a></li>
    <li><a class="dropdown-item" href="../articles/CGuideAInputs.html">Guide 1 - Inputs</a></li>
    <li><a class="dropdown-item" href="../articles/CGuideBParametersEnvironment.html">Guide 2 - Calculating Parameters From Environmental Data</a></li>
    <li><a class="dropdown-item" href="../articles/CGuideCModelResultsProcess.html">Guide 3 - Processing Model Results</a></li>
    <li><a class="dropdown-item" href="../articles/CGuideDEpiDataGenerate.html">Guide 4 - Generating Epidemiological Data From Model Output</a></li>
    <li><a class="dropdown-item" href="../articles/CGuideELikelihood.html">Guide 5 - Calculating Likelihood Of Observed Data</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Worked Example 1 - Single Model Run</h1>
            
      

      <div class="d-none name"><code>BWorkedExampleAModelRun.Rmd</code></div>
    </div>

    
    
<p>This worked example demonstrates how to set up and carry out a single
run of the model for a single region.</p>
<p>The model of yellow fever used in YEP is an age-stratified SEIRV
model in which the number of people in each age group in groups S
(susceptible), E (exposed), I (infectious), R (recovered) and V
(vaccinated) is computed at each time point, with changes in population
also incorporated. The number of new infections (individuals moving from
group S to group E) at each time point is calculated stochastically
using the total force of infection (FOI) as a binomial probability. Full
details of the model are currently being prepared for publication;
please contact <a href="https://www.imperial.ac.uk/people/keith.fraser" class="external-link">Keith Fraser</a>
for a detailed description.</p>
<p>Population and vaccination data is stored in a list object as
described in <a href="https://mrc-ide.github.io/YEP/articles/CGuideAInputs.html">Guide 1
- Inputs</a>. Here we load an example data set for multiple regions and
extract the vaccination and population data for the first included
region:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mrc-ide.github.io/YEP/">YEP</a></span><span class="op">)</span></span>
<span><span class="va">input_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/find.package.html" class="external-link">path.package</a></span><span class="op">(</span><span class="st">"YEP"</span><span class="op">)</span>, </span>
<span>                                   <span class="st">"/exdata/input_data_example.Rds"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">vacc_data</span> <span class="op">&lt;-</span> <span class="va">input_data</span><span class="op">$</span><span class="va">vacc_data</span><span class="op">[</span><span class="fl">1</span>, , <span class="op">]</span></span>
<span><span class="va">pop_data</span> <span class="op">&lt;-</span> <span class="va">input_data</span><span class="op">$</span><span class="va">pop_data</span><span class="op">[</span><span class="fl">1</span>, , <span class="op">]</span>  </span></code></pre></div>
<p>We set the other input parameters to the functions which run the
model as follows. Here we set the spillover FOI and basic reproduction
number directly; they may alternatively be calculated from environmental
covariates as described in <a href="https://mrc-ide.github.io/YEP/articles/CGuideBParametersEnvironment.html">Guide
2 - Calculating Parameters From Environmental Data</a>. The mode_start
variable is used to set the initial conditions in one of 3 ways. The
n_particles variable is used to run the model multiple times for the
same inputs; the results can be compared and/or combined to test and/or
average out the effects of the stochasticity of the model. The n_threads
variable is used to set the number of particles run in parallel (subject
to the limitations of the computer being used). [TBA - link to odin.dust
documentation]</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Force of infection due to spillover from sylvatic reservoir</span></span>
<span><span class="va">FOI_spillover</span> <span class="op">&lt;-</span> <span class="fl">1.0e-8</span>           </span>
<span><span class="co"># Basic reproduction number for urban spread of infection</span></span>
<span><span class="va">R0</span> <span class="op">&lt;-</span> <span class="fl">1.2</span></span>
<span><span class="co"># Year(s) for which data is to be output</span></span>
<span><span class="va">years_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1995</span><span class="op">:</span><span class="fl">2000</span><span class="op">)</span></span>
<span><span class="co"># SEIRV data from end of a previous run to use as input (if mode_start = 2; not </span></span>
<span><span class="co"># used here and hence set to NULL)</span></span>
<span><span class="va">start_SEIRV</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>    </span>
<span><span class="co"># Type of data to output</span></span>
<span><span class="co">#'   "full" = SEIRVC + FOI for all steps and ages</span></span>
<span><span class="co">#'   "case" = annual total new infections (C) summed across all ages</span></span>
<span><span class="co">#'   "sero" = annual SEIRV</span></span>
<span><span class="co">#'   "case+sero" = annual SEIRVC, cases summed across all ages</span></span>
<span><span class="co">#'   "case_alt" = annual total new infections not combined by age</span></span>
<span><span class="co">#'   "case_alt2" = total new infections combined by age for all steps</span></span>
<span><span class="va">output_type</span> <span class="op">&lt;-</span> <span class="st">"full"</span>             </span>
<span><span class="co"># First year in population/vaccination data (here taken from the input data set; </span></span>
<span><span class="co"># if the population and vaccination data is set manually, this similarly needs </span></span>
<span><span class="co"># to be set manually)</span></span>
<span><span class="va">year0</span> <span class="op">&lt;-</span> <span class="va">input_data</span><span class="op">$</span><span class="va">years_labels</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="co"># Flag indicating how to set initial population immunity level in addition to</span></span>
<span><span class="co"># vaccination</span></span>
<span><span class="co"># If mode_start = 0, only vaccinated individuals are immune (R = 0)</span></span>
<span><span class="co"># If mode_start = 1, shift some non-vaccinated individuals into recovered to </span></span>
<span><span class="co"># give herd immunity (R = 1 - 1/R0)</span></span>
<span><span class="co"># If mode_start = 2, use SEIRV input in list from previous run(s), set using</span></span>
<span><span class="co"># start_SEIRV variable</span></span>
<span><span class="co"># If mode_start = 3, set age-stratified herd immunity based on R0 and FOI_spillover</span></span>
<span><span class="va">mode_start</span> <span class="op">&lt;-</span> <span class="fl">1</span>  </span>
<span><span class="co"># Proportional vaccine efficacy (from 0 to 1); probability of vaccination </span></span>
<span><span class="co"># successfully providing immunity (i.e. moving vaccinated individual to group V)</span></span>
<span><span class="va">vaccine_efficacy</span> <span class="op">&lt;-</span> <span class="fl">1.0</span>       </span>
<span><span class="co"># Time increment in days to use in model (should be 1.0, 2.5 or 5.0 days)</span></span>
<span><span class="va">dt</span> <span class="op">&lt;-</span> <span class="fl">1.0</span>            </span>
<span><span class="co"># Number of particles to run</span></span>
<span><span class="va">n_particles</span> <span class="op">&lt;-</span> <span class="fl">10</span>     </span>
<span><span class="co"># Number of threads to run</span></span>
<span><span class="va">n_threads</span> <span class="op">&lt;-</span> <span class="fl">1</span>   </span>
<span><span class="co"># True/false flag indicating whether or not to run model in deterministic mode</span></span>
<span><span class="co"># (so that binomial calculations give average instead of randomized output)</span></span>
<span><span class="va">deterministic</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span></code></pre></div>
<p>We use the Model_Run() function to run the model for the inputs
above:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Model_Run.html">Model_Run</a></span><span class="op">(</span><span class="va">FOI_spillover</span>, <span class="va">R0</span>, <span class="va">vacc_data</span>, <span class="va">pop_data</span>, <span class="va">years_data</span>,</span>
<span>                   <span class="va">start_SEIRV</span>, <span class="va">output_type</span>, <span class="va">year0</span>, <span class="va">mode_start</span>, <span class="va">vaccine_efficacy</span>, </span>
<span>                   <span class="va">dt</span>, <span class="va">n_particles</span>, <span class="va">n_threads</span>, <span class="va">deterministic</span><span class="op">)</span></span></code></pre></div>
<p>The output of Model_Run(), when output_type is set to “full”,
includes, for each particle, date information, the total force of
infection FOI_total at each data point, the numbers of people in groups
S, E, I, R and V at each time point organized by age group, and the
number of newly infectious people (C) at each time point organized by
age group. We use the plot_model function from the YEPaux package to
display values of S, R and V (added together across all age groups) over
time, with error bars to show the variation between particles caused by
stochasticity if relevant.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">YEPaux</span><span class="op">)</span></span>
<span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu">plot_model_output</span><span class="op">(</span><span class="va">test1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span></span></code></pre></div>
<p>The model can be run in deterministic mode by setting the
‘deterministic’ flag to TRUE. In this mode, the number of new infections
at each time point is calculated by multiplying the number of
susceptible individuals by the total force of infection, rather than via
sampling a binomial distribution.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Model_Run.html">Model_Run</a></span><span class="op">(</span><span class="va">FOI_spillover</span>, <span class="va">R0</span>, <span class="va">vacc_data</span>, <span class="va">pop_data</span>, <span class="va">years_data</span>,</span>
<span>                   <span class="va">start_SEIRV</span>, <span class="va">output_type</span>, <span class="va">year0</span>, <span class="va">mode_start</span>, <span class="va">vaccine_efficacy</span>, </span>
<span>                   <span class="va">dt</span>, <span class="va">n_particles</span>, <span class="va">n_threads</span>, deterministic<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu">plot_model_output</span><span class="op">(</span><span class="va">test1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span></span></code></pre></div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Keith Fraser.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
