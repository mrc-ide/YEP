<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Guide 5 - Calculating Likelihood Of Observed Data • YEP</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Guide 5 - Calculating Likelihood Of Observed Data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">YEP</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/A1Introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/A2Installation.html">Installation</a></li>
    <li><a class="dropdown-item" href="../articles/BWorkedExampleAModelRun.html">Worked Example 1 - Single Model Run</a></li>
    <li><a class="dropdown-item" href="../articles/BWorkedExampleBOutbreakRiskCalculation.html">Worked Example 2 - Outbreak Risk Calculation</a></li>
    <li><a class="dropdown-item" href="../articles/BWorkedExampleCEpiDatasetGenerate.html">Worked Example 3 - Generating Epidemiological Data Sets</a></li>
    <li><a class="dropdown-item" href="../articles/BWorkedExampleDMCMC.html">Worked Example 4 - Parameter Estimation Using Markov Chain Monte Carlo Functions</a></li>
    <li><a class="dropdown-item" href="../articles/CGuideAInputs.html">Guide 1 - Inputs</a></li>
    <li><a class="dropdown-item" href="../articles/CGuideBParametersEnvironment.html">Guide 2 - Calculating Parameters From Environmental Data</a></li>
    <li><a class="dropdown-item" href="../articles/CGuideCModelResultsProcess.html">Guide 3 - Processing Model Results</a></li>
    <li><a class="dropdown-item" href="../articles/CGuideDEpiDataGenerate.html">Guide 4 - Generating Epidemiological Data From Model Output</a></li>
    <li><a class="dropdown-item" href="../articles/CGuideELikelihood.html">Guide 5 - Calculating Likelihood Of Observed Data</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Guide 5 - Calculating Likelihood Of Observed Data</h1>
            
      

      <div class="d-none name"><code>CGuideELikelihood.Rmd</code></div>
    </div>

    
    
<p>This vignette describes how to use the package to calculate the
likelihood of observing particular epidemiological data based on a
particular set of input parameters. This is used to estimate parameter
values within a Bayesian framework via Markov chain Monte Carlo
sampling, as described in <a href="https://mrc-ide.github.io/YEP/articles/BWorkedExampleDMCMC.html">Worked
Example 4 - Parameter Estimation Using Markov Chain Monte Carlo
Functions</a>.</p>
<p>Data is loaded in the same manner as in <a href="https://mrc-ide.github.io/YEP/articles/BWorkedExampleCDataGenerate.html">Worked
Example 3 - Generating Epidemiological Data Sets</a>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mrc-ide.github.io/YEP/">YEP</a></span><span class="op">)</span></span>
<span><span class="va">input_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/find.package.html" class="external-link">path.package</a></span><span class="op">(</span><span class="st">"YEP"</span><span class="op">)</span>, </span>
<span>                                  <span class="st">"/exdata/input_data_example.Rds"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">enviro_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/find.package.html" class="external-link">path.package</a></span><span class="op">(</span><span class="st">"YEP"</span><span class="op">)</span>, </span>
<span>                                  <span class="st">"/exdata/enviro_data_example.csv"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,</span>
<span>                        header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">enviro_coeffs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/find.package.html" class="external-link">path.package</a></span><span class="op">(</span><span class="st">"YEP"</span><span class="op">)</span>, </span>
<span>                                       <span class="st">"/exdata/enviro_coeffs_example.csv"</span>,</span>
<span>                                       sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">obs_sero_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/find.package.html" class="external-link">path.package</a></span><span class="op">(</span><span class="st">"YEP"</span><span class="op">)</span>, </span>
<span>                                    <span class="st">"/exdata/obs_sero_data_example.csv"</span>,</span>
<span>                                       sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">obs_case_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/find.package.html" class="external-link">path.package</a></span><span class="op">(</span><span class="st">"YEP"</span><span class="op">)</span>, </span>
<span>                                    <span class="st">"/exdata/obs_case_data_example.csv"</span>,</span>
<span>                                       sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span><span class="va">n_regions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">enviro_data</span><span class="op">)</span></span>
<span><span class="va">FOI_values</span><span class="op">=</span><span class="va">R0_values</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="va">n_regions</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">n_region</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_regions</span><span class="op">)</span><span class="op">{</span></span>
<span> <span class="va">FOI_R0_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/param_calc_enviro.html">param_calc_enviro</a></span><span class="op">(</span>enviro_coeffs <span class="op">=</span> <span class="va">enviro_coeffs</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span>, </span>
<span>                  enviro_covar_values <span class="op">=</span> <span class="va">enviro_data</span><span class="op">[</span><span class="va">n_region</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">enviro_data</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span> <span class="va">FOI_values</span><span class="op">[</span><span class="va">n_region</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">FOI_R0_values</span><span class="op">$</span><span class="va">FOI</span></span>
<span> <span class="va">R0_values</span><span class="op">[</span><span class="va">n_region</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">FOI_R0_values</span><span class="op">$</span><span class="va">R0</span></span>
<span><span class="op">}</span></span>
<span><span class="va">vaccine_efficacy</span> <span class="op">&lt;-</span> <span class="fl">1.0</span> </span>
<span><span class="va">p_severe_inf</span> <span class="op">=</span> <span class="fl">0.12</span> <span class="co"># Probability of an infection causing severe symptoms</span></span>
<span><span class="va">p_death_severe_inf</span> <span class="op">=</span> <span class="fl">0.39</span> <span class="co"># Probability of an infection with severe symptoms causing death</span></span>
<span><span class="va">p_rep_severe</span> <span class="op">=</span> <span class="fl">0.05</span> <span class="co"># Probability of reporting of an infection with severe (non-fatal) symptoms</span></span>
<span><span class="va">p_rep_death</span> <span class="op">=</span> <span class="fl">0.1</span> <span class="co"># Probability of reporting of a fatal infection</span></span>
<span><span class="va">mode_start</span> <span class="op">&lt;-</span> <span class="fl">1</span>     </span>
<span><span class="va">start_SEIRV</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>       </span>
<span><span class="va">dt</span> <span class="op">&lt;-</span> <span class="fl">1.0</span>            </span>
<span><span class="va">n_reps</span> <span class="op">&lt;-</span> <span class="fl">1</span>    </span>
<span><span class="va">deterministic</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span><span class="va">mode_parallel</span> <span class="op">&lt;-</span> <span class="st">"none"</span></span>
<span><span class="va">cluster</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span></code></pre></div>
<p>Modelled data to use for the likelihood calculation is created using
Generate_Dataset() as in Worked Example 3:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">model_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Generate_Dataset.html">Generate_Dataset</a></span><span class="op">(</span><span class="va">input_data</span>,<span class="va">FOI_values</span>,<span class="va">R0_values</span>,<span class="va">obs_sero_data</span>,<span class="va">obs_case_data</span>,<span class="va">vaccine_efficacy</span>,</span>
<span>                             <span class="va">p_severe_inf</span>,<span class="va">p_death_severe_inf</span>,<span class="va">p_rep_severe</span>,<span class="va">p_rep_death</span>,<span class="va">mode_start</span>,</span>
<span>                             <span class="va">start_SEIRV</span>,<span class="va">dt</span>,<span class="va">n_reps</span>,<span class="va">deterministic</span>,<span class="va">mode_parallel</span>,cluster<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p>The likelihood of the observed serological data based on the
epidemiological parameters is calculated using a gamma distribution,
with (for each line of data) the modelled seroprevalence as the
probability of “success”, the number of samples for the specified
region, age range and year as the number of “observations”, and the
number of positive tests as the number of “successes”.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sero_like</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Special.html" class="external-link">lgamma</a></span><span class="op">(</span><span class="va">obs_sero_data</span><span class="op">$</span><span class="va">samples</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html" class="external-link">lgamma</a></span><span class="op">(</span><span class="va">obs_sero_data</span><span class="op">$</span><span class="va">positives</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span> <span class="op">-</span> </span>
<span>                   <span class="fu"><a href="https://rdrr.io/r/base/Special.html" class="external-link">lgamma</a></span><span class="op">(</span><span class="va">obs_sero_data</span><span class="op">$</span><span class="va">samples</span> <span class="op">-</span> <span class="va">obs_sero_data</span><span class="op">$</span><span class="va">positives</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                   <span class="va">obs_sero_data</span><span class="op">$</span><span class="va">positives</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">model_data</span><span class="op">$</span><span class="va">model_sero_values</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                   <span class="op">(</span><span class="va">obs_sero_data</span><span class="op">$</span><span class="va">samples</span> <span class="op">-</span> <span class="va">obs_sero_data</span><span class="op">$</span><span class="va">positives</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1.0</span> <span class="op">-</span> <span class="va">model_data</span><span class="op">$</span><span class="va">model_sero_values</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The likelihood of the observed annual case and death data based on
the epidemiological parameters is calculated using a negative binomial
distribution, with (for each line of data) the modelled number of cases
or deaths as the mean and the observed number of cases or deaths as the
number of “successes”.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cases_like</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/NegBinomial.html" class="external-link">dnbinom</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">obs_case_data</span><span class="op">$</span><span class="va">cases</span>,mu <span class="op">=</span> <span class="va">model_data</span><span class="op">$</span><span class="va">model_case_values</span>,</span>
<span>                          size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">obs_case_data</span><span class="op">$</span><span class="va">cases</span><span class="op">)</span><span class="op">)</span>,log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">deaths_like</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/NegBinomial.html" class="external-link">dnbinom</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">obs_case_data</span><span class="op">$</span><span class="va">deaths</span>,mu <span class="op">=</span> <span class="va">model_data</span><span class="op">$</span><span class="va">model_death_values</span>,</span>
<span>                           size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">obs_case_data</span><span class="op">$</span><span class="va">deaths</span><span class="op">)</span><span class="op">)</span>,log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Keith Fraser.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
