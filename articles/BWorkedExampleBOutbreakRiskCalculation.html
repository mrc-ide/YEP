<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Worked Example 2 - Outbreak Risk Calculation • YEP</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Worked Example 2 - Outbreak Risk Calculation">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">YEP</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/A1Introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/A2Installation.html">Installation</a></li>
    <li><a class="dropdown-item" href="../articles/BWorkedExampleAModelRun.html">Worked Example 1 - Single Model Run</a></li>
    <li><a class="dropdown-item" href="../articles/BWorkedExampleBOutbreakRiskCalculation.html">Worked Example 2 - Outbreak Risk Calculation</a></li>
    <li><a class="dropdown-item" href="../articles/BWorkedExampleCEpiDatasetGenerate.html">Worked Example 3 - Generating Epidemiological Data Sets</a></li>
    <li><a class="dropdown-item" href="../articles/BWorkedExampleDMCMC.html">Worked Example 4 - Parameter Estimation Using Markov Chain Monte Carlo Functions</a></li>
    <li><a class="dropdown-item" href="../articles/CGuideAInputs.html">Guide 1 - Inputs</a></li>
    <li><a class="dropdown-item" href="../articles/CGuideBParametersEnvironment.html">Guide 2 - Calculating Parameters From Environmental Data</a></li>
    <li><a class="dropdown-item" href="../articles/CGuideCModelResultsProcess.html">Guide 3 - Processing Model Results</a></li>
    <li><a class="dropdown-item" href="../articles/CGuideDEpiDataGenerate.html">Guide 4 - Generating Epidemiological Data From Model Output</a></li>
    <li><a class="dropdown-item" href="../articles/CGuideELikelihood.html">Guide 5 - Calculating Likelihood Of Observed Data</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Worked Example 2 - Outbreak Risk Calculation</h1>
            
      

      <div class="d-none name"><code>BWorkedExampleBOutbreakRiskCalculation.Rmd</code></div>
    </div>

    
    
<p>This worked example demonstrates how the package can be used to model
the occurrence and risk of yellow fever outbreaks.</p>
<p>An “outbreak” is defined as taking place whenever a case of yellow
fever is reported. Note that for a high yellow fever burden and/or
reporting rate, modelled cases may appear continuously rather than being
divided into discrete outbreaks; the methods described here are aimed
primarily at modelling situations where reported cases are relatively
rare (either due to actual infections being rare or due to low reporting
rates), so that there is a significant chance of zero cases being
reported over the course of a year.</p>
<p>The reporting of yellow fever cases is governed by the probability of
an infection which causes severe but non-fatal symptoms being reported
(p_rep_severe) and the probability of a fatal infection being reported
(p_rep_death). It is assumed that infections not leading to severe or
fatal symptoms are not reported. The proportion of infections which
cause severe symptoms is given by the quantity p_severe_inf, and the
proportion of severe infections which lead to death is given by the
quantity p_death_severe_inf. These have values of 0.12 and 0.39
respectively within the package, based on <a href="https://doi.org/10.1186/s12879-021-06535-4" class="external-link">Servadio et
al</a>.</p>
<p>As described in <a href="https://mrc-ide.github.io/YEP/articles/BWorkedExampleAModelRun.html">Worked
Example 1 - Single Model Run</a>, we obtain data on the number of new
infectious individuals at each time point during a modelled period from
the Model_Run() function. Due to potential memory limitations,
Model_Run() does not accept a number of particles (n_particles) higher
than 20. To run a large number of stochastic repetitions, the
Model_Run_Many_Reps() function should be used instead. This function can
accept any number of repetitions (n_reps), splitting them into groups of
particles of a size up to 20 (division) and running those groups
sequentially. Here we set output_type = “infs” so that
Model_Run_Many_Reps() only outputs annual total infection data, since
this is what we are interested in.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mrc-ide.github.io/YEP/">YEP</a></span><span class="op">)</span></span>
<span><span class="va">input_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/find.package.html" class="external-link">path.package</a></span><span class="op">(</span><span class="st">"YEP"</span><span class="op">)</span>,<span class="st">"/exdata/input_data_example.Rds"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">n_reps</span> <span class="op">=</span> <span class="fl">100</span> <span class="co"># Number of stochastic repetitions</span></span>
<span><span class="va">years_data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1990</span><span class="op">:</span><span class="fl">2000</span><span class="op">)</span></span>
<span><span class="va">model_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Model_Run_Many_Reps.html">Model_Run_Many_Reps</a></span><span class="op">(</span>FOI_spillover <span class="op">=</span> <span class="fl">1.0e-8</span>, R0 <span class="op">=</span> <span class="fl">0.0</span>, vacc_data <span class="op">=</span> <span class="va">input_data</span><span class="op">$</span><span class="va">vacc_data</span><span class="op">[</span><span class="fl">1</span>,,<span class="op">]</span>, </span>
<span>                                  pop_data <span class="op">=</span> <span class="va">input_data</span><span class="op">$</span><span class="va">pop_data</span><span class="op">[</span><span class="fl">1</span>,,<span class="op">]</span>, <span class="va">years_data</span>, year0 <span class="op">=</span> <span class="va">input_data</span><span class="op">$</span><span class="va">years_labels</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                                  vaccine_efficacy <span class="op">=</span> <span class="fl">1.0</span>, time_inc <span class="op">=</span> <span class="fl">1.0</span>, output_type <span class="op">=</span> <span class="st">"infs"</span>, mode_start <span class="op">=</span> <span class="fl">1</span>,  </span>
<span>                                  start_SEIRV <span class="op">=</span> <span class="cn">NULL</span>, mode_time <span class="op">=</span> <span class="fl">0</span>,  n_reps <span class="op">=</span> <span class="va">n_reps</span>, division <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p>We can calculate the number of reported cases by year for a single
repetition using the case_data_calculate() function:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_rep_select</span> <span class="op">=</span> <span class="fl">1</span> <span class="co">#Select repetition to examine</span></span>
<span><span class="va">p_severe_inf</span> <span class="op">=</span> <span class="fl">0.12</span> <span class="co"># Probability of an infection causing severe symptoms</span></span>
<span><span class="va">p_death_severe_inf</span> <span class="op">=</span> <span class="fl">0.39</span> <span class="co"># Probability of an infection with severe symptoms causing death</span></span>
<span><span class="va">p_rep_severe</span> <span class="op">=</span> <span class="fl">0.1</span> <span class="co"># Probability of reporting of an infection with severe (non-fatal) symptoms</span></span>
<span><span class="va">p_rep_death</span> <span class="op">=</span> <span class="fl">0.2</span> <span class="co"># Probability of reporting of a fatal infection</span></span>
<span><span class="va">case_data_single</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/case_data_calculate.html">case_data_calculate</a></span><span class="op">(</span><span class="va">model_data</span>, n_p <span class="op">=</span> <span class="va">n_rep_select</span>, <span class="va">p_severe_inf</span>, <span class="va">p_death_severe_inf</span>,</span>
<span>                                        <span class="va">p_rep_severe</span>, <span class="va">p_rep_death</span>,output_type <span class="op">=</span> <span class="st">"annual"</span>, deterministic <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">case_data_single</span></span></code></pre></div>
<p>One or more outbreaks are considered to have occurred in a year if
the number of reported cases is more than 1, so binary outbreak
occurrence is considered to be 1 (true) in years 4 and 10 and 0 (false)
in the other years in the above results.</p>
<p>We can calculate case data across multiple repetitions quickly with
the case_data_calculate_multi() function:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">case_data_multi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/case_data_calculate_multi.html">case_data_calculate_multi</a></span><span class="op">(</span><span class="va">model_data</span>, <span class="va">p_severe_inf</span>, <span class="va">p_death_severe_inf</span>,<span class="va">p_rep_severe</span>, </span>
<span>                                             <span class="va">p_rep_death</span>,output_type <span class="op">=</span> <span class="st">"annual"</span>, deterministic <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">case_data_multi</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p>The risk of one or more outbreaks in a given year can be calculated
by checking the outbreak occurence for that year for every stochastic
repetitions and dividing the number of repetitions in which the outbreak
occurence is 1 (i.e. those where the number of reported cases is &gt;=1)
by the total number of repetitions.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_years</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">years_data</span><span class="op">)</span></span>
<span><span class="va">outbreak_risk</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">n_years</span><span class="op">)</span></span>
<span><span class="va">dp</span><span class="op">=</span><span class="fl">1.0</span><span class="op">/</span><span class="va">n_reps</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">n_year</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_years</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">n_rep</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_reps</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">case_data_multi</span><span class="op">[[</span><span class="va">n_rep</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">rep_cases</span><span class="op">[</span><span class="va">n_year</span><span class="op">]</span><span class="op">&gt;=</span><span class="fl">1</span><span class="op">)</span><span class="op">{</span><span class="va">outbreak_risk</span><span class="op">[</span><span class="va">n_year</span><span class="op">]</span><span class="op">=</span><span class="va">outbreak_risk</span><span class="op">[</span><span class="va">n_year</span><span class="op">]</span><span class="op">+</span><span class="va">dp</span><span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">years_data</span>,y<span class="op">=</span><span class="va">outbreak_risk</span>,type<span class="op">=</span><span class="st">"b"</span>,col<span class="op">=</span><span class="fl">1</span>,pch<span class="op">=</span><span class="fl">1</span>,xlab<span class="op">=</span><span class="st">"Year"</span>,ylab<span class="op">=</span><span class="st">"Outbreak risk"</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">outbreak_risk</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Keith Fraser.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
