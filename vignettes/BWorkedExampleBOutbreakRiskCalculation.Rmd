---
title: "Worked Example 2 - Outbreak Risk Calculation"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Worked Example 2 - Outbreak Risk Calculation}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

This worked example demonstrates how the package can be used to model the occurrence and risk of yellow fever outbreaks. 

An "outbreak" is defined as taking place whenever a case of yellow fever is reported. Note that for a high yellow fever burden and/or reporting rate, modelled cases may appear continuously rather than being divided into discrete outbreaks; the methods described here are aimed primarily at modelling situations where reported cases are relatively rare (either due to actual infections being rare or due to low reporting rates), so that there is a significant chance of zero cases being reported over the course of a year.

The reporting of yellow fever cases is governed by the probability of an infection which causes severe but non-fatal symptoms being reported (p_rep_severe) and the probability of a fatal infection being reported (p_rep_death). It is assumed that infections not leading to severe or fatal symptoms are not reported. The proportion of infections which cause severe symptoms is given by the quantity p_severe_inf, and the proportion of severe infections which lead to death is given by the quantity p_death_severe_inf. These have values of 0.12 and 0.39 respectively within the package, based on [Servadio et al](https://doi.org/10.1186/s12879-021-06535-4).

As described in [Worked Example 1 - Single Model Run](https://mrc-ide.github.io/YEP/articles/BWorkedExampleAModelRun.html), we obtain data on the number of new infectious individuals at each time point during a modelled period from the Model_Run() function. Due to potential memory limitations, Model_Run() does not accept a number of particles (n_particles) higher than 20. To run a large number of stochastic repetitions, the Model_Run_Many_Reps() function should be used instead. This function can accept any number of repetitions (n_reps), splitting them into groups of particles of a size up to 20 (division) and running those groups sequentially.

```{r,eval=FALSE}
set.seed(1)
library(YEP)
input_data <- readRDS(file = paste(path.package("YEP"),"/exdata/input_data_example.Rds", sep = ""))
model_data <- Model_Run_Many_Reps(FOI_spillover = 1.0e-7, R0 = 0.0, vacc_data = input_data$vacc_data[1,,], 
                             pop_data = input_data$pop_data[1,,], years_data = c(1990:2000),
                             start_SEIRV = NULL, output_type = "case", year0 = input_data$years_labels[1], 
                             mode_start = 1, vaccine_efficacy = 1.0, dt = 1.0, 
                             n_reps = 100, division = 10)
```

[TBA]
